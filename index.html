<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ² å‘½é‹éª°å­ãƒ»æ©Ÿç‡è¿·å®®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            padding: 30px;
            text-align: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.4);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .game-area {
            padding: 30px;
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
        }

        .maze {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 10px;
            aspect-ratio: 1;
            max-width: 600px;
            margin: 0 auto;
        }

        .cell {
            border: 3px solid #ddd;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 15px;
            font-size: 14px;
            font-weight: bold;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
            min-height: 120px;
        }

        .cell:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .start {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
            border-color: #0080ff;
            animation: pulse 2s infinite;
        }

        .goal {
            background: linear-gradient(135deg, #fa709a, #fee140);
            color: white;
            border-color: #ff6b6b;
            animation: sparkle 1.5s infinite alternate;
        }

        .path {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            border-color: #74b9ff;
        }

        .player {
            background: linear-gradient(135deg, #fd79a8, #fdcb6e) !important;
            border-color: #e17055 !important;
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(253, 121, 168, 0.6);
            animation: playerGlow 1s infinite alternate;
        }

        .blocked {
            background: linear-gradient(135deg, #b2bec3, #636e72);
            color: white;
            border-color: #636e72;
        }

        .event-info {
            font-size: 12px;
            margin-top: 8px;
            padding: 5px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            line-height: 1.2;
        }

        .probability {
            color: #e17055;
            font-weight: bold;
        }

        .sidebar {
            background: linear-gradient(135deg, #f8f9ff, #e8eaf6);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .dice-container {
            text-align: center;
            margin-bottom: 30px;
        }

        .dice {
            width: 80px;
            height: 80px;
            background: white;
            border: 3px solid #74b9ff;
            border-radius: 15px;
            font-size: 36px;
            font-weight: bold;
            color: #2d3436;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            box-shadow: 0 5px 15px rgba(116, 185, 255, 0.3);
            transition: all 0.3s ease;
        }

        .dice.rolling {
            animation: diceRoll 1s ease-in-out;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            color: white;
        }

        .stats {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .stats h3 {
            color: #2d3436;
            margin-bottom: 15px;
            text-align: center;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .message {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            min-height: 120px;
        }

        .message h4 {
            color: #2d3436;
            margin-bottom: 10px;
        }

        .success {
            border-left: 5px solid #00b894;
        }

        .fail {
            border-left: 5px solid #e17055;
        }

        .info {
            border-left: 5px solid #74b9ff;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes sparkle {
            0% { filter: brightness(1); }
            100% { filter: brightness(1.3); }
        }

        @keyframes playerGlow {
            0% { box-shadow: 0 0 20px rgba(253, 121, 168, 0.6); }
            100% { box-shadow: 0 0 30px rgba(253, 121, 168, 0.9); }
        }

        @keyframes diceRoll {
            0% { transform: rotateY(0deg) rotateX(0deg); }
            25% { transform: rotateY(90deg) rotateX(90deg); }
            50% { transform: rotateY(180deg) rotateX(180deg); }
            75% { transform: rotateY(270deg) rotateX(270deg); }
            100% { transform: rotateY(360deg) rotateX(360deg); }
        }

        .math-formula {
            background: #f8f9ff;
            border: 2px solid #74b9ff;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .game-area {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .cell {
                min-height: 80px;
                padding: 8px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ² å‘½é‹éª°å­ãƒ»æ©Ÿç‡è¿·å®®</h1>
            <p>é€ééª°å­èˆ‡æ©Ÿç‡çµ±è¨ˆï¼Œæ¢ç´¢æ•¸å­¸çš„å¥§ç§˜ï¼</p>
        </header>

        <div class="game-area">
            <div class="maze-section">
                <div class="maze" id="maze"></div>
            </div>

            <div class="sidebar">
                <div class="dice-container">
                    <h3>ğŸ² å‘½é‹éª°å­</h3>
                    <div class="dice" id="dice">?</div>
                    <div class="controls">
                        <button class="btn btn-primary" onclick="rollDice()">æ“²éª°å­</button>
                        <button class="btn btn-secondary" onclick="resetGame()">é‡æ–°é–‹å§‹</button>
                    </div>
                </div>

                <div class="stats">
                    <h3>ğŸ“Š éŠæˆ²çµ±è¨ˆ</h3>
                    <div class="stat-item">
                        <span>ç›®å‰ä½ç½®:</span>
                        <span id="position">(0, 3)</span>
                    </div>
                    <div class="stat-item">
                        <span>ç§»å‹•æ¬¡æ•¸:</span>
                        <span id="moves">0</span>
                    </div>
                    <div class="stat-item">
                        <span>æˆåŠŸç‡:</span>
                        <span id="successRate">0%</span>
                    </div>
                </div>

                <div class="message info" id="message">
                    <h4>ğŸ® éŠæˆ²èªªæ˜</h4>
                    <p>æ­¡è¿ä¾†åˆ°æ©Ÿç‡è¿·å®®ï¼é»æ“Šç›¸é„°çš„æ ¼å­é¸æ“‡è·¯å¾‘ï¼Œæ¯æ¢è·¯å¾‘éƒ½æœ‰ä¸åŒçš„äº‹ä»¶æ¢ä»¶ã€‚æ“²éª°å­ç¬¦åˆæ¢ä»¶å°±èƒ½å‰é€²ï¼Œç›®æ¨™æ˜¯åˆ°é”å³ä¸Šè§’çš„çµ‚é»ï¼</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // éŠæˆ²ç‹€æ…‹
        let gameState = {
            playerPos: { x: 0, y: 3 },
            goalPos: { x: 3, y: 0 },
            currentDice: null,
            selectedPath: null,
            moves: 0,
            successes: 0,
            isRolling: false
        };

        // è¿·å®®äº‹ä»¶é…ç½®
        const mazeEvents = {
            '0,2': { condition: 'å¶æ•¸', set: [2, 4, 6], prob: 0.5, desc: 'å¶æ•¸ = {2,4,6}' },
            '0,1': { condition: 'â‰¥4', set: [4, 5, 6], prob: 0.5, desc: 'â‰¥4 = {4,5,6}' },
            '1,3': { condition: 'â‰¤3', set: [1, 2, 3], prob: 0.5, desc: 'â‰¤3 = {1,2,3}' },
            '1,2': { condition: 'å¥‡æ•¸æˆ–â‰¥5', set: [1, 3, 5, 6], prob: 0.67, desc: '{1,3,5} âˆª {5,6} = {1,3,5,6}' },
            '1,1': { condition: 'ä¸æ˜¯1', set: [2, 3, 4, 5, 6], prob: 0.83, desc: 'è£œé›† = {2,3,4,5,6}' },
            '1,0': { condition: 'å¶æ•¸ä¸”â‰¥4', set: [4, 6], prob: 0.33, desc: '{2,4,6} âˆ© {4,5,6} = {4,6}' },
            '2,3': { condition: 'è³ªæ•¸', set: [2, 3, 5], prob: 0.5, desc: 'è³ªæ•¸ = {2,3,5}' },
            '2,2': { condition: 'â‰¤4', set: [1, 2, 3, 4], prob: 0.67, desc: 'â‰¤4 = {1,2,3,4}' },
            '2,1': { condition: '3çš„å€æ•¸', set: [3, 6], prob: 0.33, desc: '3çš„å€æ•¸ = {3,6}' },
            '3,3': { condition: 'â‰¥3', set: [3, 4, 5, 6], prob: 0.67, desc: 'â‰¥3 = {3,4,5,6}' },
            '3,2': { condition: 'å¶æ•¸æˆ–1', set: [1, 2, 4, 6], prob: 0.67, desc: '{2,4,6} âˆª {1} = {1,2,4,6}' },
            '3,1': { condition: 'â‰¥5', set: [5, 6], prob: 0.33, desc: 'â‰¥5 = {5,6}' }
        };

        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            const maze = document.getElementById('maze');
            maze.innerHTML = '';

            for (let y = 0; y < 4; y++) {
                for (let x = 0; x < 4; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.id = `cell-${x}-${y}`;
                    cell.onclick = () => selectPath(x, y);

                    if (x === 0 && y === 3) {
                        cell.className += ' start player';
                        cell.innerHTML = `<div style="font-size: 24px;">ğŸš€</div><div>èµ·é»</div>`;
                    } else if (x === 3 && y === 0) {
                        cell.className += ' goal';
                        cell.innerHTML = `<div style="font-size: 24px;">ğŸ†</div><div>çµ‚é»</div>`;
                    } else {
                        const key = `${x},${y}`;
                        const event = mazeEvents[key];
                        if (event) {
                            cell.className += ' path';
                            cell.innerHTML = `
                                <div style="font-size: 18px;">âš¡</div>
                                <div class="event-info">
                                    <div><strong>${event.condition}</strong></div>
                                    <div class="probability">P = ${(event.prob * 100).toFixed(0)}%</div>
                                    <div style="font-size: 10px;">${event.desc}</div>
                                </div>
                            `;
                        } else {
                            cell.className += ' blocked';
                            cell.innerHTML = `<div style="font-size: 18px;">ğŸš«</div><div>å°é–</div>`;
                        }
                    }

                    maze.appendChild(cell);
                }
            }

            updateStats();
            updateMessage('ğŸ® éŠæˆ²èªªæ˜', 'æ­¡è¿ä¾†åˆ°æ©Ÿç‡è¿·å®®ï¼é»æ“Šç›¸é„°çš„æ ¼å­é¸æ“‡è·¯å¾‘ï¼Œæ¯æ¢è·¯å¾‘éƒ½æœ‰ä¸åŒçš„äº‹ä»¶æ¢ä»¶ã€‚æ“²éª°å­ç¬¦åˆæ¢ä»¶å°±èƒ½å‰é€²ï¼Œç›®æ¨™æ˜¯åˆ°é”å³ä¸Šè§’çš„çµ‚é»ï¼', 'info');
        }

        // é¸æ“‡è·¯å¾‘
        function selectPath(x, y) {
            if (gameState.isRolling) return;

            const dx = Math.abs(x - gameState.playerPos.x);
            const dy = Math.abs(y - gameState.playerPos.y);

            // æª¢æŸ¥æ˜¯å¦ç‚ºç›¸é„°æ ¼å­
            if ((dx === 1 && dy === 0) || (dx === 0 && dy === 1)) {
                if (x === 3 && y === 0) {
                    // åˆ°é”çµ‚é»
                    updateMessage('ğŸ‰ æ­å–œï¼', 'ä½ æˆåŠŸåˆ°é”çµ‚é»ï¼æ•¸å­¸èˆ‡é‹æ°£çš„å®Œç¾çµåˆï¼', 'success');
                    return;
                }

                const key = `${x},${y}`;
                const event = mazeEvents[key];
                
                if (event) {
                    gameState.selectedPath = { x, y, event };
                    updateMessage('ğŸ“ è·¯å¾‘é¸æ“‡', `ä½ é¸æ“‡äº†æ¢ä»¶ã€Œ${event.condition}ã€çš„è·¯å¾‘ã€‚<div class="math-formula">æ¨£æœ¬ç©ºé–“ S = {1,2,3,4,5,6}<br>äº‹ä»¶ E = ${JSON.stringify(event.set)}<br>P(E) = ${event.set.length}/6 = ${(event.prob * 100).toFixed(0)}%</div>ç¾åœ¨æ“²éª°å­è©¦è©¦é‹æ°£å§ï¼`, 'info');
                } else {
                    updateMessage('ğŸš« ç„¡æ³•é€šè¡Œ', 'é€™æ¢è·¯å¾‘è¢«å°é–äº†ï¼Œè«‹é¸æ“‡å…¶ä»–è·¯ç·šï¼', 'fail');
                }
            } else {
                updateMessage('âš ï¸ ç§»å‹•é™åˆ¶', 'ä½ åªèƒ½ç§»å‹•åˆ°ç›¸é„°çš„æ ¼å­ï¼', 'info');
            }
        }

        // æ“²éª°å­
        function rollDice() {
            if (!gameState.selectedPath || gameState.isRolling) {
                updateMessage('âš ï¸ æé†’', 'è«‹å…ˆé¸æ“‡ä¸€æ¢è·¯å¾‘ï¼', 'info');
                return;
            }

            gameState.isRolling = true;
            const dice = document.getElementById('dice');
            dice.classList.add('rolling');
            dice.textContent = 'ğŸ²';

            setTimeout(() => {
                const result = Math.floor(Math.random() * 6) + 1;
                gameState.currentDice = result;
                dice.textContent = result;
                dice.classList.remove('rolling');
                gameState.isRolling = false;

                checkResult(result);
            }, 1000);
        }

        // æª¢æŸ¥çµæœ
        function checkResult(diceResult) {
            const { event } = gameState.selectedPath;
            const success = event.set.includes(diceResult);

            gameState.moves++;
            if (success) {
                gameState.successes++;
                movePlayer();
                updateMessage('âœ… æˆåŠŸï¼', `éª°å­é¡¯ç¤º ${diceResult}ï¼Œç¬¦åˆæ¢ä»¶ã€Œ${event.condition}ã€ï¼ä½ å¯ä»¥å‰é€²äº†ã€‚<div class="math-formula">éª°å­çµæœ = ${diceResult}<br>äº‹ä»¶é›†åˆ = ${JSON.stringify(event.set)}<br>${diceResult} âˆˆ ${JSON.stringify(event.set)} ï¼Ÿ æ˜¯ï¼</div>`, 'success');
            } else {
                updateMessage('âŒ å¤±æ•—', `éª°å­é¡¯ç¤º ${diceResult}ï¼Œä¸ç¬¦åˆæ¢ä»¶ã€Œ${event.condition}ã€ã€‚è«‹é‡æ–°é¸æ“‡è·¯å¾‘ã€‚<div class="math-formula">éª°å­çµæœ = ${diceResult}<br>äº‹ä»¶é›†åˆ = ${JSON.stringify(event.set)}<br>${diceResult} âˆˆ ${JSON.stringify(event.set)} ï¼Ÿ å¦ï¼</div>`, 'fail');
            }

            gameState.selectedPath = null;
            updateStats();
        }

        // ç§»å‹•ç©å®¶
        function movePlayer() {
            // ç§»é™¤èˆŠä½ç½®çš„ç©å®¶æ¨™è¨˜
            const oldCell = document.getElementById(`cell-${gameState.playerPos.x}-${gameState.playerPos.y}`);
            oldCell.classList.remove('player');

            // æ›´æ–°ä½ç½®
            gameState.playerPos = { x: gameState.selectedPath.x, y: gameState.selectedPath.y };

            // æ·»åŠ æ–°ä½ç½®çš„ç©å®¶æ¨™è¨˜
            const newCell = document.getElementById(`cell-${gameState.playerPos.x}-${gameState.playerPos.y}`);
            newCell.classList.add('player');

            // æª¢æŸ¥æ˜¯å¦åˆ°é”çµ‚é»
            if (gameState.playerPos.x === 3 && gameState.playerPos.y === 0) {
                setTimeout(() => {
                    updateMessage('ğŸ‰ å‹åˆ©ï¼', `æ­å–œä½ æˆåŠŸé€šéæ©Ÿç‡è¿·å®®ï¼<br>ç¸½ç§»å‹•æ¬¡æ•¸ï¼š${gameState.moves}<br>æˆåŠŸç‡ï¼š${((gameState.successes / gameState.moves) * 100).toFixed(1)}%<br><br>ä½ å·²ç¶“æŒæ¡äº†æ¨£æœ¬ç©ºé–“ã€äº‹ä»¶ã€æ©Ÿç‡è¨ˆç®—ç­‰é‡è¦æ¦‚å¿µï¼`, 'success');
                }, 500);
            }
        }

        // æ›´æ–°çµ±è¨ˆ
        function updateStats() {
            document.getElementById('position').textContent = `(${gameState.playerPos.x}, ${gameState.playerPos.y})`;
            document.getElementById('moves').textContent = gameState.moves;
            const rate = gameState.moves > 0 ? ((gameState.successes / gameState.moves) * 100).toFixed(1) : 0;
            document.getElementById('successRate').textContent = `${rate}%`;
        }

        // æ›´æ–°è¨Šæ¯
        function updateMessage(title, content, type) {
            const message = document.getElementById('message');
            message.className = `message ${type}`;
            message.innerHTML = `<h4>${title}</h4><p>${content}</p>`;
        }

        // é‡ç½®éŠæˆ²
        function resetGame() {
            gameState = {
                playerPos: { x: 0, y: 3 },
                goalPos: { x: 3, y: 0 },
                currentDice: null,
                selectedPath: null,
                moves: 0,
                successes: 0,
                isRolling: false
            };

            document.getElementById('dice').textContent = '?';
            initGame();
        }

        // å•Ÿå‹•éŠæˆ²
        initGame();
    </script>
</body>
</html>
